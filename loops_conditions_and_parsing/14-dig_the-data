#!/usr/bin/env bash
# This script groups visitors by IP and HTTP status code from an Apache log, handles small, large, and incorrectly formatted logs

# Check if the log file exists
log_file="access.log"

if [[ ! -f "$log_file" ]]; then
  echo "Log file not found!"
  exit 1
fi

# Use awk to extract the IP and HTTP status code, count occurrences, and sort by count
awk '$9 ~ /^[0-9]+$/ {print $1, $9}' "$log_file" | \
awk '{count[$1 " " $2]++} END {for (entry in count) print count[entry], entry}' | \
sort -nr
